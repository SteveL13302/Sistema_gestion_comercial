{% extends 'menu.html' %}

{% block title %}Destinatarios{% endblock %}

{% block content %}
  <div class="info-cliente">

    <!-- Lista de destinatarios  -->
    <h2 class="mb-4">Lista de Destinatarios</h2>
    <a href="{% url 'nuevo_destinatario' %}" class="nuevo-pedido mr-3"><i class="fa-solid fa-circle-plus"></i> Nuevo
      Destinatario</a>
      <form method="get" action="{% url 'pedidos' %}">
        <div class="filters">
            <label for="estado_pedido">Estado del Pedido:</label>
            <select name="estado_pedido" id="estado_pedido">
                <option value="">--Seleccione--</option>
                {% for estado in estados_pedido %}
                    <option value="{{ estado }}" {% if filtro_estado_pedido == estado %}selected{% endif %}>{{ estado }}</option>
                {% endfor %}
            </select>
    
            <label for="estado_pago">Estado del Pago:</label>
            <select name="estado_pago" id="estado_pago">
                <option value="">--Seleccione--</option>
                {% for estado in estados_pago %}
                    <option value="{{ estado }}" {% if filtro_estado_pago == estado %}selected{% endif %}>{{ estado }}</option>
                {% endfor %}
            </select>
    
            <button type="submit">Filtrar</button>
        </div>
    </form>
    
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Cliente</th>
                <th scope="col">Producto</th>
                <th scope="col">Estado Pedido</th>
                <th scope="col">Estado Pago</th>
                <th scope="col">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <th scope="row" data-label="#">{{ forloop.counter }}</th>
                <td data-label="Cliente">{{ pedido.cliente }}</td>
                <td data-label="Producto">{{ pedido.producto }}</td>
                <td data-label="Estado Pedido">{{ pedido.estado }}</td>
                <td data-label="Estado Pago">{{ pedido.pago.estado }}</td>
                <td>
                    <!-- Botones para acciones -->
                    <a href="{% url 'detalle_pedido' pedido.id %}" class="btn btn-info btn-sm">Ver Detalle</a>
                    <form action="{% url 'eliminar_pedido' pedido.id %}" method="post" style="display:inline;" class="delete-form">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
  </div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delete-form').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const form = e.target;

        Swal.fire({
          title: '¿Estás seguro?',
          text: "¡No podrás recuperar este destinatario después de eliminarlo!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Sí, eliminar',
          cancelButtonText: 'Cancelar'
        }).then((result) => {
          if (result.isConfirmed) {
            form.submit(); 
          }
        });
      });
    });
  });
</script>
{% endblock %}